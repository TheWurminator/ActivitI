//This is a class that when instantiated will allow connections to the database
function DBConnection() {	
	this.mysql = require("mysql"); //Requiring the mysql module, used to connect to db
	this.dbinfo = require('./connection.json'); //This is the connection file we're using instead of hard-coding it into this file
	this.con = this.mysql.createConnection({ //Setting the parameters for the connection from the connection file
		host	: this.dbinfo.host, //JSON Parsing is being used here
		user	: this.dbinfo.user,
		password: this.dbinfo.password,
		database: this.dbinfo.database
	});

	this.con.connect(function(err){ //If the database is not able to be connected to
  		if(err){
    		console.log('Error connecting to Db');
    		return;
  		}
  		else{
  			console.log('Connection established'); //Success
  		}
	});
}
//This is a function that sends an arbitrary query to the database
DBConnection.prototype.sendQuery = function(queryString, callBack, httpResponse){ //Query, callbackref, router response reference
	console.log("Query: " + queryString); //DEBUG
	var query = this.con.query(queryString, function(err, response){ //Sends the actual query to the database
		if(err){
			console.log(err);
			callBack(err, httpResponse); //Calls the callback function in the caller module to send the err back to the user
		}
		else{
			callBack(response, httpResponse); //Calls the callback function in the coller module to send the response back to the user
		}
	});
}

//End the connection to the database
DBConnection.prototype.endConnection = function(){
	//This is just a function that ends the connection to the server
	this.con.end(function(err){
		if(err){
			console.log(err); //Throw an error if there is one
		}
		//console.log('The connection to the server has been terminated');
	});
}

//Exposes the class itself to the caller module, (i.e. the module that "require"d it)
module.exports = DBConnection;
